================================================================================
 BCL - CHANGE LOG
================================================================================
Historial de cambios del intérprete BCL (Basic Command Language)
Autor: Rafa
Fecha: Octubre 2025
================================================================================

--------------------------------------------------------------------------------
[1.6.0] - 2025-10-21
--------------------------------------------------------------------------------

*** CARACTERÍSTICAS PRINCIPALES ***

1. IMPLEMENTACIÓN DE REGEXP Y REGSUB (STANDALONE)
   ------------------------------------------------

   * REGEXP - Búsqueda de patrones con expresiones regulares básicas
     - Motor propio sin dependencias externas (sin PCRE2)
     - Patrones soportados: . * + ? ^ $
     - Clases predefinidas: \d \w \s (y negadas \D \W \S)
     - Opciones: NOCASE, ALL, MATCH

   * REGSUB - Sustitución de texto con patrones
     - Reemplazo simple o global (opción ALL)
     - Opciones: NOCASE, COUNT
     - Soporte de escape de caracteres especiales

   * Archivo: src/bcl_regexp.c (600+ líneas)

2. MANUAL COMPLETO DE USUARIO EN LaTeX
   ------------------------------------

   * BCL_Manual.tex - Manual profesional de 64 páginas
     - 16 capítulos cubriendo desde lo básico hasta avanzado
     - 50+ ejemplos de código completos con salida y explicación
     - Diseñado para principiantes sin experiencia en programación
     - Incluye: TOC, lista de tablas, lista de código
     - Formato profesional con tcolorbox para ejemplos
     - Sintaxis highlighting personalizado para BCL
     - Compilable con lualatex

   * BCL_Manual.pdf - PDF generado (449 KB, formato A4)

   * Archivo: docs/BCL_Manual.tex (2500+ líneas)

*** ESTADÍSTICAS ***

   - Comandos totales: 60/60 (100% del core BCL)
   - Líneas de código: ~12,000
   - Archivos fuente: 20 archivos .c
   - Documentación: Manual completo de usuario (64 páginas PDF)
   - Sin dependencias externas: Totalmente standalone

*** ARCHIVOS NUEVOS/MODIFICADOS ***

   - src/bcl_regexp.c       - NUEVO (600+ líneas) - Motor regex básico
   - src/bcl_parser.c       - Modificado (soporte \d, \w, \s)
   - src/bcl_eval.c         - Modificado (registro REGEXP/REGSUB)
   - docs/BCL_Manual.tex    - NUEVO (2500+ líneas) - Manual LaTeX
   - docs/BCL_Manual.pdf    - NUEVO (64 páginas, 449 KB) - PDF

*** REGEXP/REGSUB: FUNCIONALIDAD Y LIMITACIONES ***

   FUNCIONA BIEN PARA:
   -------------------
   - Búsqueda de patrones simples: REGEXP "foo" "seafood" -> 1
   - Conteo de coincidencias: REGEXP "a" "abracadabra" ALL -> 5
   - Sustitución global: REGSUB "a" "text" "X" ALL -> reemplaza todas
   - Matching case-insensitive: REGEXP "HELLO" "hello" NOCASE -> 1
   - Metacaracteres básicos: . (any), * (0+), + (1+), ? (0-1)
   - Anclas: ^ (inicio), $ (fin)
   - Clases: \d (dígito), \w (palabra), \s (espacio)

   LIMITACIONES CONOCIDAS:
   -----------------------
   - Clases [abc] NO SOPORTADAS - El parser BCL interpreta [] como
     sustitución de comandos
     Solución: Usar \d, \w, \s en su lugar

   - Captura con MATCH limitada - Solo captura primer carácter en
     patrones con cuantificadores
     Ejemplo: REGEXP "\d+" "abc123" MATCH n -> n="1" (debería ser "123")

   - NO IMPLEMENTADO:
     * Grupos de captura () con backreferences \1, \2
     * Cuantificadores {m,n}
     * Alternancia |
     * Lookahead/lookbehind
     * Modo multilinea completo

   CONCLUSIÓN: Implementación suficiente para casos de uso básicos
   (validación, búsqueda, reemplazo simple). Para regex complejos,
   considerar BCL 2.0 con PCRE2.

*** MANUAL DE USUARIO: CONTENIDO ***

   ESTRUCTURA DEL MANUAL:
   ----------------------
   1. Introducción - Qué es BCL, instalación, primeros pasos con REPL
   2. Fundamentos de Programación - Para principiantes absolutos
   3. Variables y Datos - SET, UNSET, INCR, APPEND, GLOBAL, scope
   4. Expresiones y Matemáticas - EXPR, operadores, funciones
   5. Estructuras de Control - IF, WHILE, FOR, FOREACH, SWITCH
   6. Procedimientos - PROC, parámetros, RETURN, recursión
   7. Listas - LIST, LINDEX, LAPPEND, LSORT, etc.
   8. Manipulación de Strings - STRING, FORMAT, SCAN
   9. Operaciones con Archivos - OPEN, CLOSE, READ, PUTS, FILE, GLOB
   10. Expresiones Regulares - REGEXP, REGSUB (básico)
   11. Tiempo y Fecha - CLOCK comandos
   12. Interacción con el Sistema - EXEC, ENV, ARGV, EVAL, SOURCE
   13. Introspección - INFO comandos
   14. Ejemplos Completos - Procesador, calculadora, gestor de tareas
   15. Referencia de Comandos - Tabla alfabética completa
   16. Apéndices - Instalación, troubleshooting, diferencias con Tcl

   CARACTERÍSTICAS DEL MANUAL:
   ----------------------------
   - Lenguaje claro y simple para principiantes
   - 50+ ejemplos completos con salida esperada
   - Tablas profesionales con booktabs
   - Cajas de colores para tips, warnings, ejemplos, notas
   - Índice automático, TOC, listas de tablas y código
   - Sintaxis highlighting personalizado para BCL
   - Hipervínculos y bookmarks PDF
   - Listo para impresión (formato A4)

*** COMPILACIÓN DEL MANUAL ***

   cd docs
   lualatex BCL_Manual.tex
   lualatex BCL_Manual.tex
   lualatex BCL_Manual.tex

--------------------------------------------------------------------------------
[1.5.1] - 2025-10-21
--------------------------------------------------------------------------------

*** CARACTERÍSTICAS PRINCIPALES ***

1. IMPLEMENTACIÓN COMPLETA DE CLOCK
   ---------------------------------

   * CLOCK SECONDS - Tiempo actual en segundos desde Unix epoch
     (1970-01-01 00:00:00 UTC)

   * CLOCK MILLISECONDS - Tiempo actual en milisegundos con precisión
     de gettimeofday()

   * CLOCK MICROSECONDS - Tiempo actual en microsegundos para mediciones
     de alta precisión

   * CLOCK FORMAT - Formateo de timestamps a strings con soporte de
     strftime()
     - Opción FORMAT para especificar formato personalizado
     - Opción GMT para usar UTC en lugar de hora local
     - Formato por defecto: "%a %b %d %H:%M:%S %Z %Y" (estilo Tcl)

   * CLOCK SCAN - Parsing de strings a timestamps con soporte de
     strptime()
     - Opción FORMAT para especificar formato de entrada
     - Opción GMT para interpretar como UTC
     - Opción BASE para especificar timestamp base
     - Formatos automáticos: "now", "YYYY-MM-DD", "YYYY-MM-DD HH:MM:SS"

   * CLOCK ADD - Aritmética de tiempo para sumar/restar intervalos
     - Unidades soportadas: seconds, minutes, hours, days, weeks,
       months, years
     - Soporte de múltiples intervalos:
       CLOCK ADD $t 1 day 3 hours 30 minutes
     - Valores negativos para restar tiempo
     - Normalización automática con mktime()

*** ESTADÍSTICAS ***

   - Comandos totales: 58/57 (CLOCK añade 1 comando con 6 subcomandos)
   - Líneas de código: ~10,900 (+388 en bcl_clock.c)
   - Precisión de tiempo: Microsegundos (1/1,000,000 segundo)
   - Compatibilidad: POSIX C99, macOS/Linux

*** ARCHIVOS MODIFICADOS ***

   - src/bcl_clock.c        - NUEVO (388 líneas) - Implementación CLOCK
   - src/bcl_eval.c         - Modificado (registro de comando CLOCK)
   - include/bcl_commands.h - Ya incluía declaración de CLOCK

*** CASOS DE USO ***

   MEDICIÓN DE TIEMPO DE EJECUCIÓN:
   ---------------------------------
   SET start [CLOCK MICROSECONDS]
   # ... código a medir ...
   SET end [CLOCK MICROSECONDS]
   SET elapsed [EXPR $end - $start]
   PUTS "Tiempo: $elapsed microsegundos"

   FORMATEO DE FECHAS:
   -------------------
   SET now [CLOCK SECONDS]
   SET fecha [CLOCK FORMAT $now FORMAT "%d/%m/%Y %H:%M:%S"]
   PUTS "Fecha: $fecha"

   CÁLCULOS DE TIEMPO:
   -------------------
   SET deadline [CLOCK ADD [CLOCK SECONDS] 7 days]
   SET formatted [CLOCK FORMAT $deadline FORMAT "%Y-%m-%d"]
   PUTS "Fecha límite: $formatted"

*** LIMITACIONES (POR DISEÑO) ***

   - TIMEZONE: Opción reconocida pero ignorada (requeriría IANA timezone
     database)
   - LOCALE: Opción reconocida pero ignorada (usa locale del sistema)
   - DST: Manejo básico mediante mktime() con tm_isdst = -1

--------------------------------------------------------------------------------
[1.5.0] - 2025-10-21
--------------------------------------------------------------------------------

*** CARACTERÍSTICAS PRINCIPALES ***

1. REPL COMPLETAMENTE REESCRITO
   -----------------------------

   * Comandos multilínea: Soporte completo para IF...END, PROC...END,
     WHILE...DO...END, etc.

   * Historial de comandos: Buffer circular de 10 comandos con navegación

   * Navegación con flechas: Teclas UP/DOWN para navegar el historial
     (sin dependencias de readline)

   * Terminal raw mode: Captura de teclas especiales sin librerías externas

   * Auto-print de resultados: Muestra valores automáticamente en modo
     interactivo

   * Prompt inteligente: "BCL>" para comandos nuevos, "...>" para
     continuación multilínea

   * Edición básica: Backspace, Ctrl+C, Ctrl+D

   * Archivo: src/bcl_repl.c expandido de 67 a 513 líneas

2. COMANDOS DE SISTEMA (6 NUEVOS)
   -------------------------------

   * EVAL - Evaluación dinámica de código BCL
   * SOURCE - Ejecución de archivos BCL externos
   * EXEC - Ejecución de comandos del sistema operativo
   * ENV - Acceso a variables de entorno
   * ARGV - Acceso a argumentos del script
   * AFTER - Delays en milisegundos

   * Archivo: src/bcl_system.c (276 líneas)

*** BUGS CORREGIDOS ***

1. BUG CRÍTICO: FUNCIONES MATEMÁTICAS
   -----------------------------------

   Problema: Funciones como sin(), sqrt(), pow() devolvían argumentos
   sin evaluar

   Causa: Algoritmo Shunting Yard no evaluaba funciones después del
   paréntesis de cierre

   Solución: Evaluación correcta de funciones con 1 y 2 argumentos

   Archivo: src/bcl_expr.c (líneas 353-371)

   Test: sin(3.14159) ahora devuelve ≈0 (antes devolvía 3.14159)

2. BUG CRÍTICO: OPERADOR ** (POTENCIA)
   ------------------------------------

   Problema: 2 ** 8 devolvía 16 en vez de 256 (hacía 2 * 8)

   Causa: Tokenizador no reconocía "**" como operador de dos caracteres

   Solución: Verificación de "**" antes de operadores de un solo carácter

   Archivo: src/bcl_expr.c (líneas 202-205)

   Test: 2 ** 8 ahora devuelve 256 correctamente

3. BUG: PROC NO FUNCIONABA EN REPL
   --------------------------------

   Problema: Escribir PROC en REPL causaba error "invalid command name"

   Causa: REPL procesaba línea por línea, PROC requiere multilínea

   Solución: Implementación de buffer multilínea con detección de bloques

   Archivo: src/bcl_repl.c

*** MEJORAS ***

   - Auto-print en REPL: Comandos muestran resultados sin necesidad de PUTS
   - Modo archivo vs REPL: Solo auto-imprime en modo interactivo
   - Detección de bloques: Reconocimiento inteligente de IF, WHILE, FOR,
     FOREACH, SWITCH, PROC
   - Navegación de historial: Implementación robusta con límites correctos
     (no pasa del más antiguo/nuevo)
   - Manejo de ESC: Detección mejorada de secuencias de escape con timeouts

*** ESTADÍSTICAS ***

   - Comandos totales: 57/57 (100% del core)
   - Líneas de código: ~10,500
   - Módulos completados: 14/14 (100%)
   - Bugs críticos: 0
   - Warnings de compilación: 6 menores (no críticos)

*** ARCHIVOS MODIFICADOS ***

   - src/bcl_system.c - NUEVO (276 líneas)
   - src/bcl_repl.c   - REESCRITO (67 → 513 líneas)
   - src/bcl_expr.c   - CORREGIDO (bugs de funciones y **)
   - src/bcl_eval.c   - Modificado (registro de comandos de sistema)
   - Makefile         - Reorganizado (archivos .o en src/)

*** REORGANIZACIÓN DE DIRECTORIOS ***

   ELIMINADAS:
   -----------
   - code/  (no se usaba)
   - lib/   (no se usaba)
   - build/ (archivos .o ahora en src/)

   ESTRUCTURA FINAL:
   -----------------
   - src/      - Código fuente (incluye archivos .o y .d)
   - bin/      - Binario compilado
   - include/  - Headers
   - def/      - Definiciones de comandos
   - docs/     - Documentación
   - examples/ - Ejemplos (vacía, lista para usar)

--------------------------------------------------------------------------------
[1.0.0] - 2025-10-20
--------------------------------------------------------------------------------

*** IMPLEMENTACIÓN INICIAL ***

1. CATEGORÍAS IMPLEMENTADAS (100%)
   --------------------------------

   VARIABLES:
   ----------
   - SET, UNSET, INCR, APPEND

   I/O:
   ----
   - PUTS, GETS

   EXPRESIONES:
   ------------
   - EXPR con soporte completo de:
     * Operadores: +, -, *, /, %, ** (potencia)
     * Funciones trigonométricas: sin, cos, tan, asin, acos, atan
     * Funciones hiperbólicas: sinh, cosh, tanh
     * Raíces: sqrt, cbrt
     * Redondeo: abs, int, floor, ceil, round
     * Logaritmos: ln, log, log10, log2, exp
     * Potencias: pow
     * Min/Max: min, max
     * Otras: sign, rand, rad, deg, hypot, atan2, fmod

   CONTROL DE FLUJO:
   -----------------
   - IF...THEN...ELSE...END
   - WHILE...DO...END
   - FOR...IN...DO...END
   - FOREACH...IN...DO...END
   - SWITCH...CASE...DEFAULT...END
   - BREAK, CONTINUE, RETURN, EXIT

   PROCEDIMIENTOS:
   ---------------
   - PROC...WITH...DO...END
   - CALL (implícito al invocar procedimiento)

   LISTAS:
   -------
   - LIST, LAPPEND, LINDEX, LLENGTH, LRANGE
   - LSORT, LSEARCH, LINSERT, LREPLACE
   - CONCAT, JOIN, SPLIT

   STRINGS:
   --------
   - STRLEN, STRINDEX, STRRANGE, STRCAT
   - STRCMP, STRUPPER, STRLOWER, STRTRIM
   - STRREPLACE, STRREPEAT

   FORMATEO:
   ---------
   - FORMAT (printf-style)
   - SCAN (scanf-style)

   ARCHIVOS I/O:
   -------------
   - OPEN, CLOSE, READ, WRITE
   - FLUSH, EOF, SEEK, TELL

   ARCHIVOS OPS:
   -------------
   - PWD (directorio actual)
   - FILE (operaciones: exists, delete, rename, copy, size, type,
     mtime, readable, writable)
   - GLOB (expansión de patrones)

   INTROSPECCIÓN:
   --------------
   - INFO (commands, vars, procs, locals, globals, exists)

   PARSER Y EVALUADOR:
   -------------------
   - Sustitución de variables: $var, ${var}
   - Sustitución de comandos: [command]
   - Evaluación estructurada para bloques
   - Manejo de comillas dobles y llaves
   - Case-insensitive para comandos

*** ESTADÍSTICAS INICIALES ***

   - Comandos base: 51
   - Líneas de código: ~9,700
   - REPL: Básico (67 líneas)
   - Standalone: Sin dependencias externas (readline, pcre, utf8proc)

*** ARQUITECTURA ***

   - Parser: Tokenización con soporte de sustituciones
   - Evaluador: Separación entre eval simple y structured
   - Hash table: Implementación propia para variables y procedimientos
   - Memory management: Sin memory leaks conocidos
   - Platform: macOS/Unix (POSIX C99)

================================================================================
NOTAS DE DESARROLLO
================================================================================

*** FILOSOFÍA DEL PROYECTO ***

BCL es un intérprete ligero inspirado en Tcl pero más simple:
- NO REQUIERE LIBRERÍAS EXTERNAS (standalone)
- SINTAXIS CLARA similar a BASIC
- CASE-INSENSITIVE para comandos (como BASIC)
- PROCEDIMIENTOS EN MAYÚSCULAS por convención
- MINIMALISTA - solo comandos core, sin extensiones complejas

*** COMANDOS NO IMPLEMENTADOS (POR DISEÑO) ***

Los siguientes comandos de Tcl NO están en BCL intencionalmente:
- CD - Cambio de directorio (usar EXEC cd o PWD)
- DICT - Diccionarios (usar listas)
- ERROR/CATCH - Manejo de excepciones complejo
- UPVAR/UPLEVEL - Manipulación de scope avanzada
- NAMESPACE - Espacios de nombres
- TRACE - Debugging avanzado

*** OPCIONALES PARA BCL 2.0 ***

Características consideradas para versiones futuras:
- REGEXP/REGSUB con PCRE2 (10-15 horas) - IMPLEMENTADO en 1.6.0 (básico)
- CLOCK completo con timezones (12-18 horas) - IMPLEMENTADO en 1.5.1 (básico)
- Soporte Unicode/UTF-8 (utf8proc)
- Módulo de red (sockets)
- Serialización JSON/XML

================================================================================
CONVENCIONES
================================================================================

*** Características nuevas
*** Bugs corregidos
*** Mejoras
*** Estadísticas
*** Archivos
*** Arquitectura
*** Deprecaciones
*** Seguridad

================================================================================
REFERENCIAS
================================================================================

- Repositorio: (pendiente)
- Documentación: docs/
- Especificaciones: def/
- Licencia: (pendiente)

================================================================================
FIN DEL CHANGELOG
================================================================================
