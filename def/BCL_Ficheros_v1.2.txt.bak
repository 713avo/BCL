BCL — Manual de Referencia Específico: FICHEROS (v1.2)
----------------------------------------------------
Autor: Rafa
Fecha: Octubre 2025

Basado en BCL v1.5 (Edición PC).
Inspirado en Tcl 8.x, con sintaxis BCL (sin switches con '-').
Soporte Unicode en rutas y contenido.

NOVEDADES v1.2
- Añadidos: PWD y GLOB (equivalentes a Tcl 'pwd' y 'glob'), con opciones al estilo BCL.
- Revisión y ejemplos integrados con OPEN/READ/PUTS handle/GETS/CLOSE/TELL/SEEK/EOF y FILE *.

----------------------------------------------------
0) VISIÓN GENERAL
----------------------------------------------------
BCL ofrece comandos para abrir, leer, escribir y gestionar ficheros y rutas.
Los manejadores de archivo (handles) se obtienen con OPEN y se usan en READ/GETS/PUTS/CLOSE.
Para utilidades de ruta y archivos, usar FILE ...

----------------------------------------------------
1) OPEN / CLOSE
----------------------------------------------------
Propósito:
Abrir y cerrar archivos.

Sintaxis:
  OPEN ruta modo
  CLOSE handle

Modos:
  R   — lectura
  W   — escritura (crea o trunca)
  A   — añadir (append)
  RW  — lectura y escritura

Ejemplos:
SET h [OPEN "./log.txt" W]
PUTS $h "inicio\n"
CLOSE $h

SET h [OPEN "./datos.txt" R]
SET texto [READ $h]
CLOSE $h

----------------------------------------------------
2) READ / GETS / PUTS (con handle)
----------------------------------------------------
READ:
  READ handle [n]
  - Sin 'n': lee todo hasta EOF.
  - Con 'n': lee hasta 'n' bytes/caracteres.

GETS (lectura por línea):
  GETS handle
  - Devuelve una línea (sin el salto final). EOF devuelve cadena vacía "" y EOF=1.

PUTS (escritura de texto):
  PUTS handle texto
  - Escribe 'texto' y añade salto de línea al final.
  PUTSN handle texto
  - Escribe sin añadir nueva línea.

Ejemplos:
SET h [OPEN "./out.txt" W]
PUTS $h "Hola"
PUTSN $h " sin salto"
PUTS $h " y ahora con salto"
CLOSE $h

SET h [OPEN "./in.txt" R]
WHILE [EOF $h] = 0 DO
  SET linea [GETS $h]
  PUTS ">> $linea"
END
CLOSE $h

----------------------------------------------------
3) TELL / SEEK / EOF
----------------------------------------------------
TELL:
  TELL handle
  - Devuelve la posición actual del puntero de archivo (entero).

SEEK:
  SEEK handle offset WHENCE
  - WHENCE: SET (inicio), CUR (posición actual), END (final).
  - 'offset' puede ser negativo (por ejemplo con END).

EOF:
  EOF handle
  - Devuelve 1 si está al final de archivo, 0 en caso contrario.

Ejemplos:
SET h [OPEN "./bin.dat" RW]
PUTS $h "ABC"
TELL $h              ;# p.ej. 4 (depende de la plataforma)
SEEK $h 0 SET        ;# vuelve al inicio
READ $h 2            ;# "AB"
SEEK $h 0 END        ;# salta al final
PUTS $h "XYZ"
CLOSE $h

----------------------------------------------------
4) FILE (EXISTS, SIZE, DELETE, RENAME)
----------------------------------------------------
FILE EXISTS ruta   — Devuelve 1 si existe, 0 si no.
FILE SIZE ruta     — Devuelve tamaño en bytes.
FILE DELETE ruta   — Elimina el archivo.
FILE RENAME src dst — Renombra o mueve el archivo.

Ejemplos:
IF [FILE EXISTS "./out.txt"] THEN
  PUTS "existe"
END

PUTS "bytes=" [FILE SIZE "./out.txt"]
FILE RENAME "./out.txt" "./out_backup.txt"

----------------------------------------------------
5) PWD — Directorio de trabajo actual
----------------------------------------------------
Propósito:
Devuelve el directorio de trabajo actual (absolute path).

Sintaxis:
  PWD

Notas:
- Equivalente a Tcl 'pwd'.
- Útil para construir rutas relativas de forma predecible.

Ejemplos:
SET cwd [PWD]
PUTS "cwd=$cwd"

; Construir una ruta relativa fácilmente
SET ruta "$cwd/logs/app.log"

----------------------------------------------------
6) GLOB — Expansión de patrones de ruta
----------------------------------------------------
Propósito:
Lista rutas de archivos/directorios que coinciden con un patrón (tipo shell).

Sintaxis (estilo BCL, sin '-'):
  GLOB patrón [DIRECTORY dir] [TAILS] [NOCOMPLAIN] [TYPES tipo...]

Parámetros:
- patrón: admite comodines '*' y '?', y secuencias con corchetes [abc] (si se implementa).
- DIRECTORY dir: realiza la expansión dentro del directorio 'dir' (equivale a Tcl -directory).
- TAILS: devuelve sólo el nombre base (sin la ruta previa) (equivale a Tcl -tails).
- NOCOMPLAIN: no produce error si no hay coincidencias; devuelve lista vacía (equivale a Tcl -nocomplain).
- TYPES tipo...: filtra por tipo de entrada (equivale a Tcl -types). Soporte recomendado:
    d  → directorios
    f  → ficheros regulares
  (Otros tipos de Tcl como l, b, c, p, s pueden no estar disponibles según plataforma).

Comportamiento por defecto (sin opciones):
- Busca en el directorio actual (PWD).
- Devuelve rutas completas o relativas (según implementación).

Ejemplos básicos:
; Todos los .txt del cwd
SET L [GLOB "*.txt"]
PUTS $L

; Archivos .bcl en ./scripts
SET L [GLOB "*.bcl" DIRECTORY "./scripts"]
PUTS $L

; Sólo nombres (sin ruta)
SET nombres [GLOB "*.log" TAILS]
PUTS $nombres

; No fallar si no hay coincidencias
SET vacia [GLOB "no_existe_*.tmp" NOCOMPLAIN]
PUTS "coincidencias: [LLENGTH $vacia]"

; Filtrar por tipo: sólo directorios que empiezan por 'data'
SET dirs [GLOB "data*" TYPES d]
PUTS $dirs

; Combinar opciones
SET archivos [GLOB "*.c" DIRECTORY "./src" TYPES f TAILS]
PUTS $archivos

Notas y diferencias vs Tcl:
- En BCL no se usan switches con '-' (se sustituyen por palabras clave).
- 'DIRECTORY' y 'TAILS' son palabras literales, no requieren '='.
- 'TYPES' acepta una o varias letras de tipo en la misma llamada.

----------------------------------------------------
7) BUENAS PRÁCTICAS
----------------------------------------------------
- Cerrar siempre los handles con CLOSE para liberar recursos.
- Usar PWD para construir rutas de forma estable.
- En GLOB, añadir NOCOMPLAIN cuando un patrón puede no devolver resultados.
- Usar TYPES para evitar procesar directorios cuando sólo interesan ficheros (o viceversa).
- Controlar EOF al leer líneas con GETS en bucles.

----------------------------------------------------
8) EJEMPLO INTEGRADO
----------------------------------------------------
# Crear un registro con rutas encontradas y guardarlo
SET cwd [PWD]
PUTS "Explorando $cwd"

SET lista [GLOB "*.txt" NOCOMPLAIN]
IF [LLENGTH $lista] = 0 THEN
  PUTS "No hay .txt"
ELSE
  SET h [OPEN "./resumen.txt" W]
  FOREACH f IN $lista DO
    PUTS $h "TXT: $f"
  END
  CLOSE $h
  PUTS "Escrito resumen.txt"
END

# Buscar subdirectorios data* y mostrar sólo el nombre
SET soloDirs [GLOB "data*" TYPES d TAILS]
PUTS "Dirs: $soloDirs"

# Leer primer línea de cada .log
SET logs [GLOB "*.log" NOCOMPLAIN]
FOREACH log IN $logs DO
  IF [FILE EXISTS $log] THEN
    SET h [OPEN $log R]
    SET first [GETS $h]
    CLOSE $h
    PUTS "Primera línea de $log: $first"
  END
END

----------------------------------------------------
FIN DEL DOCUMENTO
----------------------------------------------------
